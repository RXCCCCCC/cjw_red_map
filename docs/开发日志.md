# 程家湾红色资源数字地图 — 开发日志

---

## 2026-02-13 地标标注样式二次优化

### 背景
上一轮优化后，地标标签的字体和描边在某些视角下略显模糊，且光晕底座不够明显。用户希望进一步提升清晰度并扩大底座范围。

### 变更内容

#### 1. 字体清晰度提升
- **字号加大**：从 `14px` 提升至 `18px`
- **字重加粗**：从 `bold` (700) 提升至 `900`（最粗），增强可读性
- **描边优化**：`outlineWidth` 从 `1` 增加到 `3`，颜色从 `BLACK` (alpha 0.6) 调整为 `BLACK` (alpha 0.8)，增强文字与背景的对比度，解决"糊"的问题

#### 2. 光晕底座扩大
- **半径**：半长轴/半短轴从 `3.5` 扩大至 `8.0`（面积增加约 5 倍）
- **透明度**：从 `0.18` 提升至 `0.25`，使其在深色背景下更具辨识度

### 效果预期
- 标签文字在 3D 场景中将更加锐利和醒目
- 红色光晕范围显著增大，使地标点在远景下更容易被发现

---

## 2026-02-13 地标标注样式美化

### 背景
地图中各地标点的标注样式较为粗糙，红色背景标签上显示了经度、纬度、高度等坐标信息，信息冗余且影响美观（如截图所示）。用户希望只保留地标名称，并优化整体视觉效果。

### 变更内容

#### 1. 标签文本精简
移除标签中的经纬度和海拔高度信息，只保留地标名称。涉及三处文本设置：
- **`addSiteMarker()`**：创建地标时的初始标签文本
- **拖动事件 `MOUSE_MOVE`**：拖动调整位置时的实时标签更新
- **`submitEditSite()`**：编辑保存后的标签同步更新

#### 2. 视觉样式优化
| 属性 | 旧值 | 新值 |
|------|------|------|
| 标签字体 | `bold 13px sans-serif` | `bold 14px "Microsoft YaHei", "PingFang SC", sans-serif` |
| 背景色 | `#C41E24` alpha 0.85 | `#B91C1C` alpha 0.92（更深沉的红色） |
| 背景内边距 | `8, 4` | `12, 6`（更宽松舒适） |
| 文字描边 | 红色描边 2px | 黑色半透明描边 1px（更清晰） |
| 标签水平对齐 | 未设置 | `CENTER`（居中于标注点上方） |
| 点大小 | 14px | 10px（更精致） |
| 点描边宽度 | 2px | 3px（白色外圈更醒目） |
| 远近缩放 | 无 | `NearFarScalar(100, 1.4, 5000, 0.6)`（近大远小） |

#### 3. 新增外圈光晕效果
为每个地标新增一个半透明红色椭圆底座（`ellipse`），半径 3.5 米、透明度 0.18，使地标点在地图上更加醒目且有层次感。

### 技术要点
- 仅修改前端 `CesiumViewer.vue`，不涉及后端或数据库变更
- 坐标信息仍保留在弹窗详情中，用户点击地标后依然可以查看
- `scaleByDistance` 实现了根据视距自动缩放的效果，近景放大显示、远景缩小避免遮挡

---

## 2026-02-13 地标标注圆角化改造

### 背景
用户希望地标标注的背景框具有圆角效果，且边框范围更大。由于 Cesium 原生 `LabelGraphics` 不支持圆角背景（`showBackground` 只能是矩形），因此需要采用 Canvas 自定义绘制生成图片，并改用 `BillboardGraphics` 进行渲染。

### 变更内容

#### 1. 渲染方式重构
- **Label → Billboard**：移除了原有的 `label` 实体组件，改为 `billboard` 组件。
- **动态 Canvas 生成**：新增 `createSiteLabelCanvas(text)` 工具函数，使用 HTML5 Canvas API 动态绘制包含文字和圆角背景的图像。

#### 2. 样式升级
- **大圆角背景**：绘制圆角半径为 `20px` 的矩形，背景色保留深红 `#B91C1C` (Alpha 0.95)。
- **内边距扩大**：水平内边距增加到 `32px`，垂直内边距增加到 `16px`，满足“边框改大”的需求。
- **超清渲染**：Canvas 绘图字号设为 `32px`（比实际显示大），Billboard 缩放比例设为 `0.5`，确保在高分屏下文字边缘依然清晰锐利。

#### 3. 逻辑适配
- **Entity 更新逻辑**：在 `submitEditSite` 中，当地标名称修改后，不再设置 `label.text`，而是调用 `createSiteLabelCanvas` 重新生成图片并赋值给 `billboard.image`。
- **拖动交互优化**：清理了拖动事件中尝试更新 `label.text` 的废弃代码。

### 技术要点
- **Canvas 绘图**：使用 `quadraticCurveTo` 绘制平滑圆角，避免兼容性问题。
- **性能优化**：Canvas 仅在地标创建或名称修改时生成一次，后续渲染直接使用纹理，性能损耗可控。
- **缩放策略**：保留了 `scaleByDistance` 配置，确保近大远小的视觉体验与之前保持一致。

---

## 2026-02-13 术语统一 & 地标描述补充

### 背景
项目最初将所有标记点统称为"遗址"（`遗址`），但随着实际标注越来越多，发现标记点涵盖纪念设施（纪念馆、胜利之门）、军事遗址（碉堡、炮台）、革命旧址（突围指挥部）、居民生活区（老人们的家）、公共设施（广场）等多种类型，"遗址"这一用词不够准确。

### 变更内容

#### 1. 术语替换："遗址" → "地标"
在全项目范围内将用户可见的"遗址"描述统一替换为"地标"（红色地标），涵盖以下文件：

| 文件 | 改动 |
|------|------|
| `backend/app/models.py` | 类注释、字段 comment |
| `backend/app/routes/site.py` | 路由函数注释 |
| `backend/app/seeds.py` | 文件头注释、打印日志 |
| `frontend/src/api/index.js` | 注释 |
| `frontend/src/router/index.js` | 路由 meta.title |
| `frontend/src/views/SiteDetail.vue` | NavBar title、section 标题 |
| `frontend/src/views/MapView.vue` | 列表标题、注释 |
| `frontend/src/views/HomeView.vue` | 入口卡片文字 |
| `frontend/src/views/AboutView.vue` | 项目简介文案 |
| `frontend/src/components/CesiumViewer.vue` | 全部 UI 文字、注释、日志 |

> **注意**：`docs/` 下的早期规划文档（`开发路线规划.md`、`程家湾地图开发随记.md`）保留原始"遗址"用词作为历史记录，未做修改。

#### 2. 地标分类与描述补充
通过 API 为数据库中缺少描述的 7 个地标补充了贴合红色资源主题的分类（`category`）和描述（`description`）：

| ID | 名称 | 分类 | 描述摘要 |
|----|------|------|----------|
| 1 | 纪念馆 | 纪念设施 | 已有描述，未修改 |
| 2 | 程家湾老人们的家 | 居民生活 | 赣东北传统民居，革命年代掩护红军伤员… |
| 3 | 碉堡 | 军事遗址 | 制高点防御工事，石头泥土堆砌，扣眼朗朵… |
| 4 | 炮台 | 军事遗址 | 山顶火炮阵地，与碉堡遥相呼应… |
| 5 | 程家湾突围指挥部 | 革命旧址 | 闽浙赣省委核心指挥中心，制定突围计划… |
| 6 | 胜利之门 | 纪念设施 | 纪念突围战胜利的标志性建筑… |
| 7 | 程家湾广场 | 公共设施 | 村中集会区，红色教育活动场所… |
| 8 | 程家湾广场 | 公共设施 | 同上（重复记录） |

### 技术要点
- 术语替换仅影响 UI 展示文本和代码注释，**不涉及数据库表结构或 API 路径的变更**（`/api/sites` 路径保持不变）
- 描述信息通过 `PUT /api/sites/:id` 接口写入 MySQL，永久生效
- 分类（`category`）字段现有值：`纪念设施`、`军事遗址`、`革命旧址`、`居民生活`、`公共设施`

---
